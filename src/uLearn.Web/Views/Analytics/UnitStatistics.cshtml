@using uLearn
@model UnitStatisticPageModel
@{
	ViewBag.Title = "Статистика и успеваемость | uLearn";
}

<body>
	<div class="wide-container">
		<h1>Модуль &laquo;@Model.UnitName&raquo;</h1>
		<ul>
			<li><a href="#rate">Оценки слайдов</a></li>
			<li><a href="#questions">Заданные вопросы</a></li>
			<li><a href="#progress">Таблица прогресса</a></li>
		</ul>

		<h2 id="rate">Оценки слайдов</h2>
		<table class="table table-condensed table-autowidth">
			<thead>
				<tr>
					<th>Слайд</th>
					<th>Непонятно</th>
					<th>Хорошо</th>
					<th>Тривиально</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var slide in Model.Slides)
				{
					<tr>
						<td>@slide.Title</td>
						<td>@Model.Rates.Count(r => r.SlideId == slide.Id && r.Rate == SlideRates.NotUnderstand)</td>
						<td>@Model.Rates.Count(r => r.SlideId == slide.Id && r.Rate == SlideRates.Good)</td>
						<td>@Model.Rates.Count(r => r.SlideId == slide.Id && r.Rate == SlideRates.Trivial)</td>
					</tr>
				}
			</tbody>
		</table>

		<h2 id="questions">Заданные вопросы</h2>
		@Html.Action("Questions", "Course", new { unitName = Model.UnitName })

		<h2 id="progress">Таблица прогресса</h2>
		<table class="tablesorter">
			<thead>
				<tr>
					<th>Имя</th>
					<th>Группа</th>
					@foreach (var slide in Model.Slides)
					{
						string text;
						if (slide is ExerciseSlide)
						{
							text = "Попыток решить:";
						}
						else if (slide is QuizSlide)
						{
							text = "Успешность квиза:";
						}
						else
						{
							text = "Посещаемость:";
						}
						<th>
							<p>@slide.Title</p>
							<p>@text</p>
						</th>
					}
				</tr>
			</thead>
			<tbody>
				@foreach (var user in Model.Table)
				{
					<tr>
						<td>
							<h6>@user.Key</h6>
						</td>
						<td data-sort-value="@user.Value.UserGroup">
							<input id="@(user.Key)" onblur="changeGroup('@user.Key')" data-url="@Url.Action("AddUserGroup", "Analytics")" type="text" value="@user.Value.UserGroup" />
						</td>
						@for (var i = 0; i < user.Value.SlidesInfo.Length; i++)
						{
							if (Model.Slides[i] is ExerciseSlide)
							{
								var styleClass = @user.Value.SlidesInfo[i].IsExerciseSolved ? "green-stat" : "red-stat";
								<td data-sort-value="@(user.Value.SlidesInfo[i].AttemptsNumber + 1000000)"
									class="@styleClass">
									@user.Value.SlidesInfo[i].AttemptsNumber
								</td>
							}
							else if (Model.Slides[i] is QuizSlide)
							{
								var styleClass = @user.Value.SlidesInfo[i].IsQuizPassed ? "green-stat" : "red-stat";
								<td data-sort-value="@(user.Value.SlidesInfo[i].QuizSuccessful + 10000)"
									class="@styleClass">
									@(user.Value.SlidesInfo[i].QuizSuccessful)%
								</td>
							}
							else
							{
								var styleClass = @user.Value.SlidesInfo[i].IsVisited ? "green-stat" : "red-stat";
								<td data-sort-value="@styleClass" class="@styleClass"></td>
							}
						}
					</tr>
				}
			</tbody>
		</table>

	</div>
</body>

@section scripts{
	<script src="~/tablesorter-master/jquery.tablesorter.js"></script>
	<script src="~/Scripts/table-configurator.js"></script>
	<script src="~/Scripts/user-group-name-change.js"></script>
}
