@using uLearn
@using uLearn.Quizes
@model CoursePageModel

@{
	ViewBag.Title = Model.Course.Title;
}
@Html.Partial("_TableOfContents", Model)


<div class="slide-container">
	<div class="container body-content">
		<div class="row">
			<div class='slide'>
				<h1>@Model.Slide.Title</h1>
				@Html.Partial("_Quiz", Model)
				@foreach (SlideBlock block in Model.Slide.Blocks)
				{
					if (block.IsCode)
					{
						<textarea class='code code-sample'>@block.Text</textarea>
					}
					else
					{
						@Html.Raw(block.RenderedText)
					}
				}
				@if (Model.Slide is ExerciseSlide)
				{
					@Html.Partial("_SolutionControl", Model)
				}
				@Html.Partial("_AskBar")
			</div>
			@Html.Partial("_RatesBar")
			@Html.Partial("_SlideNavigation", Model)
			<div id="WatchQuestions" data-url="@Url.Action("GetAllQuestions")">
				<button class="all-questions" onclick="printAllQuestions('@Model.Slide.Info.UnitName')">Посмотреть все заданные вопросы по теме</button>
			</div>
			<div class="questions-log"></div>
		</div>
	</div>

	<div>
		@if (Request.IsLocal)
		{
			<div class="modal-footer">
				<a href="#" class="prepare-solution-button" data-url="@Url.Action("PrepareSolution", new {courseId = Model.Course.Id, slideIndex = Model.SlideIndex})">Log prepared solution</a>
				<a href="#" onclick="toggleFakeRun()">Переключить в тестовый режим запуска</a>
				<script>
					function toggleFakeRun() {
						var $btn = $(".run-solution-button");
						$btn
				            .css("background-color", "blue")
				            .data("url", $btn.data("url").replace("/RunSolution", "/FakeRunSolution"));
					}
				</script>
			</div>
		}
	</div>
</div>

@section scripts{
	@Scripts.Render("~/slide-js")
	<script src="~/Scripts/slide-stats.js"></script>
	<script>
		fillRate('@Model.Rate');
	</script>
	@if (Model.Slide is ExerciseSlide)
	{
		<script> getHints("@Model.Course.Id", "@Model.Slide.Id"); </script>
	}

	@{
		var a = Model.PassedQuiz.Contains(Model.Slide.Id);
		var b = Model.Slide is QuizSlide;
		var answers = a && b ? (Model.Slide as QuizSlide).RightAnswersToQuiz : "none";
		<script> markAns('@answers')</script>
	}
}

